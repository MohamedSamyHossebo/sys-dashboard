<div class="dashboard-container p-4">
    <!-- New Header Component -->
    <app-header [systemHealth]="stats()?.health || 100" [lastUpdate]="stats()?.timestamp || ''"
        [isLoading]="isLoading()" (refresh)="refresh()" (refreshRateChange)="onRefreshRateChange($event)"
        (darkModeToggle)="onDarkModeToggle($event)">
    </app-header>

    <!-- Error Message -->
    @if (error()) {
    <div class="p-3 mb-4 bg-red-900 border-round">
        <i class="pi pi-exclamation-triangle mr-2"></i>
        {{ error() }}
    </div>
    }

    <!-- Loading State -->
    @if (isLoading() && !stats()) {
    <div class="grid">
        @for (item of [1,2,3,4]; track item) {
        <div class="col-12 md:col-6 lg:col-3">
            <p-skeleton height="200px"></p-skeleton>
        </div>
        }
    </div>
    }

    <!-- Metrics Summary Component -->
    @if (stats(); as currentStats) {
    <app-metrics-summary [cpuCores]="currentStats.cpu.cores" [memoryUsage]="currentStats.memory.usedPercentage"
        [diskUsage]="'65'" [uptime]="uptimeFormatted()" [networkCount]="currentStats.networkInterfaces"
        [health]="currentStats.health">
    </app-metrics-summary>

    <!-- Dashboard Content -->
    <div class="grid">

        <!-- System Info Card -->
        <div class="col-12 lg:col-6">
            <p-card header="System Information">
                <div class="stat-item">
                    <i class="pi pi-desktop stat-icon"></i>
                    <div>
                        <div class="stat-label">Platform</div>
                        <div class="stat-value">{{ currentStats.systemInfo.platform }} - {{ currentStats.systemInfo.type
                            }}</div>
                    </div>
                </div>

                <div class="stat-item">
                    <i class="pi pi-server stat-icon"></i>
                    <div>
                        <div class="stat-label">Hostname</div>
                        <div class="stat-value">{{ currentStats.systemInfo.hostname }}</div>
                    </div>
                </div>

                <div class="stat-item">
                    <i class="pi pi-cog stat-icon"></i>
                    <div>
                        <div class="stat-label">Architecture</div>
                        <div class="stat-value">{{ currentStats.systemInfo.architecture }}</div>
                    </div>
                </div>

                <div class="stat-item">
                    <i class="pi pi-tag stat-icon"></i>
                    <div>
                        <div class="stat-label">Release</div>
                        <div class="stat-value">{{ currentStats.systemInfo.release }}</div>
                    </div>
                </div>
            </p-card>
        </div>

        <!-- CPU Info Card -->
        <div class="col-12 lg:col-6">
            <p-card header="CPU Information">
                <div class="stat-item">
                    <i class="pi pi-microchip stat-icon"></i>
                    <div>
                        <div class="stat-label">Model</div>
                        <div class="stat-value cpu-model">{{ currentStats.cpu.model }}</div>
                    </div>
                </div>

                <div class="stat-item">
                    <i class="pi pi-th-large stat-icon"></i>
                    <div>
                        <div class="stat-label">Cores</div>
                        <div class="stat-value">{{ currentStats.cpu.cores }} Cores</div>
                    </div>
                </div>

                <div class="stat-item">
                    <i class="pi pi-gauge stat-icon"></i>
                    <div>
                        <div class="stat-label">Speed</div>
                        <div class="stat-value">{{ currentStats.cpu.speed }} MHz</div>
                    </div>
                </div>

                <div class="mt-3">
                    <p-tag [value]="currentStats.cpu.cores + ' Logical Processors'" severity="info" [rounded]="true">
                    </p-tag>
                </div>
            </p-card>
        </div>

        <!-- Memory Info Card -->
        <div class="col-12 lg:col-6">
            <p-card header="Memory Usage">
                <div class="stat-item">
                    <i class="pi pi-database stat-icon"></i>
                    <div class="flex-1">
                        <div class="stat-label">Total Memory</div>
                        <div class="stat-value">{{ currentStats.memory.totalGB }} GB</div>
                    </div>
                </div>

                <div class="stat-item">
                    <i class="pi pi-chart-bar stat-icon"></i>
                    <div class="flex-1">
                        <div class="stat-label">Used Memory</div>
                        <div class="stat-value">{{ currentStats.memory.usedGB }} GB ({{
                            currentStats.memory.usedPercentage }}%)</div>
                    </div>
                </div>

                <div class="mt-3">
                    <p-progressBar [value]="currentStats.memory.usedPercentage" [showValue]="true"
                        [style]="{'height': '2rem'}" [color]="getMemoryUsageColor()">
                    </p-progressBar>
                </div>

                <div class="mt-3 flex gap-2">
                    <p-tag [value]="'Free: ' + currentStats.memory.freeGB + ' GB'" severity="success"></p-tag>
                    <p-tag [value]="'Used: ' + currentStats.memory.usedGB + ' GB'"
                        [severity]="getMemoryUsageSeverity()"></p-tag>
                </div>
            </p-card>
        </div>

        <!-- Memory Chart Card -->
        <div class="col-12 lg:col-6">
            <p-card header="Memory Distribution">
                @if (memoryChartData()) {
                <div class="chart-container">
                    <p-chart type="doughnut" [data]="memoryChartData()!" [options]="memoryChartOptions"
                        [style]="{'height': '250px'}">
                    </p-chart>
                </div>
                }
            </p-card>
        </div>

        <!-- Uptime Card -->
        <div class="col-12 lg:col-6">
            <p-card header="System Uptime">
                <div class="uptime-display">
                    <i class="pi pi-clock uptime-icon"></i>
                    <div class="uptime-value">{{ uptimeFormatted() }}</div>
                </div>

                <div class="mt-3 grid text-center">
                    <div class="col-3">
                        <div class="uptime-number">{{ currentStats.uptime.formatted.days }}</div>
                        <div class="uptime-label">Days</div>
                    </div>
                    <div class="col-3">
                        <div class="uptime-number">{{ currentStats.uptime.formatted.hours }}</div>
                        <div class="uptime-label">Hours</div>
                    </div>
                    <div class="col-3">
                        <div class="uptime-number">{{ currentStats.uptime.formatted.minutes }}</div>
                        <div class="uptime-label">Minutes</div>
                    </div>
                    <div class="col-3">
                        <div class="uptime-number">{{ currentStats.uptime.formatted.seconds }}</div>
                        <div class="uptime-label">Seconds</div>
                    </div>
                </div>
            </p-card>
        </div>

        <!-- Network Info Card -->
        <div class="col-12 lg:col-6">
            <p-card header="Network Interfaces">
                <div class="stat-item">
                    <i class="pi pi-wifi stat-icon"></i>
                    <div>
                        <div class="stat-label">Active Network Interfaces</div>
                        <div class="stat-value">{{ currentStats.networkInterfaces }}</div>
                    </div>
                </div>

                <div class="mt-3">
                    <p-tag [value]="currentStats.networkInterfaces + ' Interface(s) Detected'" severity="success"
                        [rounded]="true">
                    </p-tag>
                </div>
            </p-card>
        </div>

    </div>

    <!-- Last Updated -->
    <div class="mt-4 text-center text-sm opacity-70">
        <i class="pi pi-sync mr-2"></i>
        Last updated: {{ currentStats.timestamp | date:'medium' }}
        <span class="ml-2">(Auto-refreshes every 5 seconds)</span>
    </div>
    }
</div>